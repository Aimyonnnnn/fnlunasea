<!DOCTYPE html>
<html>
<head>
    <title>ì‚¬ìš©ì ë©”ì‹œì§€ ê´€ë¦¬</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>ğŸ’¬ ì‚¬ìš©ì ë©”ì‹œì§€ ê´€ë¦¬</h1>
            <a href="{{ url_for('home') }}" class="btn btn-secondary">â† ë©”ì¸ìœ¼ë¡œ</a>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'success' if category == 'success' else 'danger' }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- í†µê³„ ìš”ì•½ -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card text-center bg-danger text-white">
                    <div class="card-body">
                        <h5>ì½ì§€ ì•ŠìŒ</h5>
                        <h3>{{ messages | selectattr('status', 'equalto', 'unread') | list | length }}</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center bg-warning text-dark">
                    <div class="card-body">
                        <h5>ì½ìŒ</h5>
                        <h3>{{ messages | selectattr('status', 'equalto', 'read') | list | length }}</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center bg-success text-white">
                    <div class="card-body">
                        <h5>ë‹µë³€ ì™„ë£Œ</h5>
                        <h3>{{ messages | selectattr('status', 'equalto', 'replied') | list | length }}</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center bg-info text-white">
                    <div class="card-body">
                        <h5>ì „ì²´</h5>
                        <h3>{{ messages | length }}</h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë©”ì‹œì§€ ëª©ë¡ -->
        {% if messages %}
            <div class="card">
                <div class="card-header">
                    <h5>ğŸ“‹ ë©”ì‹œì§€ ëª©ë¡</h5>
                </div>
                <div class="card-body p-0">
                    {% for message in messages %}
                    <div class="border-bottom p-3 {% if message.status == 'unread' %}bg-light{% endif %}">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="d-flex align-items-center mb-2">
                                    <strong class="me-3">{{ message.username }}</strong>
                                    
                                    {% if message.status == 'unread' %}
                                        <span class="badge bg-danger">ì½ì§€ ì•ŠìŒ</span>
                                    {% elif message.status == 'read' %}
                                        <span class="badge bg-warning">ì½ìŒ</span>
                                    {% elif message.status == 'replied' %}
                                        <span class="badge bg-success">ë‹µë³€ ì™„ë£Œ</span>
                                    {% endif %}
                                    
                                    {% if message.user_exists %}
                                        <span class="badge bg-primary ms-2">ë“±ë¡ëœ ì‚¬ìš©ì</span>
                                    {% else %}
                                        <span class="badge bg-secondary ms-2">ë¯¸ë“±ë¡ ì‚¬ìš©ì</span>
                                    {% endif %}
                                    
                                    <small class="text-muted ms-auto">{{ message.created_at[:19] }}</small>
                                </div>
                                
                                {% if message.contact_info %}
                                    <div class="mb-2">
                                        <small class="text-muted">ğŸ“ ì—°ë½ì²˜: {{ message.contact_info }}</small>
                                    </div>
                                {% endif %}
                                
                                <div class="mb-2">
                                    <p class="mb-1">{{ message.message }}</p>
                                </div>
                                
                                {% if message.admin_reply %}
                                    <div class="bg-success bg-opacity-10 p-2 rounded">
                                        <small class="text-muted">âœ… ê´€ë¦¬ì ë‹µë³€ ({{ message.replied_at[:19] }}):</small>
                                        <p class="mb-0">{{ message.admin_reply }}</p>
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-4">
                                <div class="d-grid gap-2">
                                    {% if message.status == 'unread' %}
                                        <a href="{{ url_for('message_read', message_id=message.id) }}" 
                                           class="btn btn-sm btn-warning">ğŸ‘ï¸ ì½ìŒ ì²˜ë¦¬</a>
                                    {% endif %}
                                    
                                    {% if message.status != 'replied' %}
                                        <button class="btn btn-sm btn-success" data-bs-toggle="collapse" 
                                                data-bs-target="#reply-{{ message.id }}">ğŸ’¬ ë‹µë³€í•˜ê¸°</button>
                                    {% endif %}
                                    
                                    <a href="{{ url_for('message_delete', message_id=message.id) }}" 
                                       class="btn btn-sm btn-danger"
                                       onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ğŸ—‘ï¸ ì‚­ì œ</a>
                                </div>
                                
                                <!-- ë‹µë³€ í¼ -->
                                {% if message.status != 'replied' %}
                                <div class="collapse mt-3" id="reply-{{ message.id }}">
                                    <form method="POST" action="{{ url_for('message_reply', message_id=message.id) }}">
                                        <div class="mb-3">
                                            <label class="form-label">ê´€ë¦¬ì ë‹µë³€</label>
                                            <textarea class="form-control" name="admin_reply" rows="3" 
                                                      placeholder="ì‚¬ìš©ìì—ê²Œ ì „ë‹¬í•  ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”..." required></textarea>
                                        </div>
                                        <div class="d-grid gap-2">
                                            <button type="submit" class="btn btn-sm btn-primary">ğŸ“¤ ë‹µë³€ ì „ì†¡</button>
                                        </div>
                                    </form>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        {% else %}
            <div class="alert alert-info text-center">
                <h5>ğŸ“­ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤</h5>
                <p class="mb-0">ì•„ì§ ì‚¬ìš©ìê°€ ë³´ë‚¸ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        {% endif %}

        <!-- ì•ˆë‚´ ì‚¬í•­ -->
        <div class="mt-4">
            <div class="alert alert-info">
                <h6>ğŸ“‹ ë©”ì‹œì§€ ê´€ë¦¬ ì•ˆë‚´</h6>
                <ul class="mb-0">
                    <li><strong>ì½ì§€ ì•ŠìŒ</strong>: ìƒˆë¡œ ë„ì°©í•œ ë©”ì‹œì§€</li>
                    <li><strong>ì½ìŒ</strong>: í™•ì¸í–ˆì§€ë§Œ ì•„ì§ ë‹µë³€í•˜ì§€ ì•Šì€ ë©”ì‹œì§€</li>
                    <li><strong>ë‹µë³€ ì™„ë£Œ</strong>: ì‚¬ìš©ìì—ê²Œ ë‹µë³€ì„ ë³´ë‚¸ ë©”ì‹œì§€</li>
                    <li><strong>ë“±ë¡ëœ ì‚¬ìš©ì</strong>: ì‹œìŠ¤í…œì— ë“±ë¡ëœ ì‚¬ìš©ìì˜ ë©”ì‹œì§€</li>
                    <li><strong>ë¯¸ë“±ë¡ ì‚¬ìš©ì</strong>: ì‹œìŠ¤í…œì— ì—†ëŠ” ì‚¬ìš©ìëª…ìœ¼ë¡œ ë³´ë‚¸ ë©”ì‹œì§€</li>
                </ul>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html> 