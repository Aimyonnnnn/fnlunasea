<!DOCTYPE html>
<html>
<head>
    <title>ì‚¬ìš©ì ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>ì‚¬ìš©ì ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
        <div class="mb-3">
            <a href="{{ url_for('add_user') }}" class="btn btn-primary">ì‚¬ìš©ì ì¶”ê°€</a>
            <a href="{{ url_for('manage_groups') }}" class="btn btn-primary">ê·¸ë£¹ ê´€ë¦¬</a>
            <a href="{{ url_for('dashboard') }}" class="btn btn-success">ğŸ“Š ì ‘ì† í†µê³„</a>
            <a href="{{ url_for('admin_messages') }}" class="btn btn-info">ğŸ’¬ ë©”ì‹œì§€ ê´€ë¦¬</a>
            <a href="{{ url_for('admin_settings') }}" class="btn btn-info">ê´€ë¦¬ì ì„¤ì •</a>
            <a href="{{ url_for('logout') }}" class="btn btn-secondary">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
        <!-- ê²€ìƒ‰ ë° ê·¸ë£¹ í•„í„° -->
        <form method="POST" class="mb-3">
            <div class="row">
                <div class="col-md-4">
                    <input type="text" class="form-control" name="search_term" placeholder="ì‚¬ìš©ì ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰" value="{{ search_term }}">
                </div>
                <div class="col-md-4">
                    <select name="group_id" class="form-select" onchange="this.form.submit()">
                        <option value="all" {% if selected_group_id == 'all' %}selected{% endif %}>ì „ì²´ ë³´ê¸°</option>
                        {% for group in groups %}
                        <option value="{{ group[0] }}" {% if selected_group_id == group[0] %}selected{% endif %}>
                            {{ group[1] }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary">ê²€ìƒ‰</button>
                </div>
            </div>
        </form>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'success' if category == 'success' else 'danger' }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ì‚¬ìš©ì ì´ë¦„</th>
                    <th>ì´ë¦„</th>
                    <th>ì—°ë½ì²˜</th>
                    <th>í—ˆìš© IP</th>
                    <th>ë§Œë£Œì¼</th>
                    <th>ê·¸ë£¹</th>
                    <th>ìƒíƒœ</th>
                    <th>ë¡œê·¸ì¸ ìƒíƒœ</th>
                    <th>ì‘ì—…</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>{{ user[1] }}</td>
                    <td>{{ user[6] or 'ì—†ìŒ' }}</td>
                    <td>{{ user[7] or 'ì—†ìŒ' }}</td>
                    <td>{{ ', '.join(user[2]) if user[2] else 'ì œí•œ ì—†ìŒ' }}</td>
                    <td>{{ user[3] }}</td>
                    <td>
                        {% for group in groups %}
                            {% if group[0] == user[5] %}
                                {{ group[1] }}
                            {% endif %}
                        {% endfor %}
                        {% if not user[5] %}
                            ê·¸ë£¹ ì—†ìŒ
                        {% endif %}
                    </td>
                    <td>{{ 'í™œì„±' if user[4] else 'ë¹„í™œì„±' }}</td>
                    <td>
                        {% if user[8] %}
                            <span style="color:#28A745;font-weight:bold;font-size:18px;">ğŸŸ¢ ë¡œê·¸ì¸ ì¤‘</span>
                            <br><small class="text-muted">{{ user[9][:19] if user[9] else '' }}</small>
                        {% else %}
                            <span style="color:#888;font-weight:bold;font-size:18px;">âšª ì˜¤í”„ë¼ì¸</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ url_for('edit_user', user_id=user[0]) }}" class="btn btn-sm btn-warning">í¸ì§‘</a>
                        <a href="{{ url_for('delete_user', user_id=user[0]) }}" class="btn btn-sm btn-danger" 
                           onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ì‚­ì œ</a>
                        <a href="{{ url_for('test_access', user_id=user[0]) }}" class="btn btn-sm btn-success">ì ‘ì† í…ŒìŠ¤íŠ¸</a>
                        <a href="{{ url_for('view_logs', user_id=user[0]) }}" class="btn btn-sm btn-info">ë¡œê·¸ ë³´ê¸°</a>
                        {% if user[8] %}
                            <a href="{{ url_for('force_logout', user_id=user[0]) }}" class="btn btn-sm btn-secondary" 
                               onclick="return confirm('{{ user[1] }} ì‚¬ìš©ìë¥¼ ê°•ì œ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ê°•ì œ ë¡œê·¸ì•„ì›ƒ</a>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</body>
</html>